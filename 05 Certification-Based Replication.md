# Certification-Based Replication(인증기반 복제) 

인증 기반 복제는 그룹 통신 및 트랜잭션 순서 지정 기술을 사용하여 동기 복제를 달성한다.  
  
인증 기반 복제의 주요 아이디어는     
낙관적 실행이라 불리며, **충돌이 없다고 가정하고 커밋 지점에 도달할 때까지 트랜잭션을 실행하는 것이다.**     

![certificationbasedreplication](https://user-images.githubusercontent.com/50267433/190032074-3d3ef96f-e0c6-4e63-a007-96acc89e6ee0.png)
          
클라이언트(애플리케이션)가 COMMIT 명령을 수행하더라도     
바로 디스크에 쓰지 않고, 클러스터 구성원 노드로 복제 요청을 진행한다.    
이후 모든 노드들이 GTID 기반 인증을 진행한 후 디스크에 데이터를 쓴다.   
    
복제 요청 과정(write-set 전달)에서는 기본키를 사용하여 인증 테스트를 거친다.       
기본키를 통해 write-set 을 통해 반영될 행의 무결성을 검증하고 적용 여부를 판단하는 인증 과정을 거친다.       
즉, 클러스터를 구성하는 노드는 **인증 과정**을 거치면서 실제 데이터를 반영할지를 판단한다.      
인증 과정을 통해 데이터를 반영할지 판단하는 구문에서 알 수 있듯이 실패 케이스도 여럿 존재한다.   
(글로벌 트랜잭션 기본키 위배, first committer win 등등)         
  
Galera Cluster에서 인증 기반 복제 구현은 트랜잭션의 글로벌 순서에 따라 다르다.    
   
Galera Cluster는 복제하는 동안 각 트랜잭션에 전역 순서 번호 또는 를 할당 합니다. 
트랜잭션이 커밋 지점에 도달하면 노드는 마지막으로 성공한 트랜잭션의 시퀀스 번호와 비교하여 시퀀스 번호를 확인합니다. 
이 간격 내에서 발생하는 트랜잭션이 서로의 효과를 보지 못했다는 점을 감안할 때 둘 사이의 간격은 우려되는 영역입니다. 
이 간격의 모든 트랜잭션에서 해당 트랜잭션과의 기본 키 충돌이 있는지 확인합니다. 충돌이 감지되면 인증 테스트가 실패합니다.

절차는 결정적이며 모든 복제본은 동일한 순서로 트랜잭션을 수신합니다. 
따라서 모든 노드는 트랜잭션 결과에 대해 동일한 결정에 도달합니다. 
트랜잭션을 시작한 노드는 트랜잭션을 커밋했는지 여부를 클라이언트 애플리케이션에 알릴 수 있습니다.









